# ショートカット解説: QRコード複数スキャン

このショートカットは、複数のQRコードやバーコードを連続でスキャンし、スキャンした内容（musicXML）をScriptabe で動作する JavaScript XMLMerge で合成処理を行うものです。

初めてショートカットを作成する方でも分かりやすいように、各ステップを丁寧に解説します。

---

## ?? このショートカットでできること

* 入力された回数分だけ、QRコードやバーコードを連続でスキャンできます。
* スキャンしたQRコードの内容（URLなど）を一覧で確認できます。
* スキャンしたURLリストを別のショートカット（`XMLMerge`）に渡して処理を継続できます。


---

## ??? ショートカットの再現方法

iPhone/iPadの「ショートカット」アプリを開き、以下の手順でショートカットを作成していきましょう。

### 1. 新しいショートカットの作成

1.  ショートカットアプリを開きます。
2.  画面右上にある「+」ボタンをタップします。
3.  「新規ショートカット」が作成されます。

### 2. 各アクションの追加と設定

ここから、提供されたスクリーンショットを見ながら、上から順にアクションを追加していきます。

#### ① 「入力から数字を取得」

* **何をするアクション？**: ショートカットが開始される際に、外部から受け取った情報（共有シートからの入力など）の中から数字だけを抽出します。
* **追加方法**:
    1.  画面下部の検索バーで「数字を取得」と検索します。
    2.  「入力から数字を取得」をタップして追加します。

#### ② 「変数 CardCount を 数字 に設定」

* **何をするアクション？**: ①で取得した数字を「CardCount」という名前の変数に保存します。この変数を使って、後で何回QRコードをスキャンするかを制御します。
* **追加方法**:
    1.  検索バーで「変数を設定」と検索します。
    2.  「変数を設定」をタップして追加します。
    3.  「変数」の部分をタップして、「新規変数」を選択し、名前を「`CardCount`」と入力します。
    4.  「に設定」の右側の青い「`変数`」をタップし、表示されるマジック変数から「入力から取得した数字」を選択します。

#### ③ 「CardCount 繰り返す」

* **何をするアクション？**: 「CardCount」に設定された回数だけ、この中のアクションを繰り返します。
* **追加方法**:
    1.  検索バーで「繰り返す」と検索します。
    2.  「繰り返す」をタップして追加します。
    3.  追加された「繰り返す」アクションの「`数値`」の部分をタップし、マジック変数から「変数 CardCount」を選択します。

#### ④ 「アラート QRコード を撮影します を表示」

* **何をするアクション？**: QRコードのスキャンを開始する前に、「QRコードを撮影します」というメッセージを画面に表示し、ユーザーに準備を促します。
* **追加方法**:
    1.  検索バーで「アラート」と検索します。
    2.  「アラートを表示」をタップして追加します。
    3.  「こんにちは」の部分をタップして、「`QRコードを撮影します`」と入力します。
    4.  右端の矢印をタップしてオプションを表示し、「ボタンを表示」のチェックを外します（OKボタンを押さずにすぐに次のアクションへ進むため）。

#### ⑤ 「QR またはバーコードをスキャン」

* **何をするアクション？**: カメラを起動し、QRコードやバーコードをスキャンします。スキャンした内容は次のアクションに渡されます。
* **追加方法**:
    1.  検索バーで「QR」と検索します。
    2.  「QRまたはバーコードをスキャン」をタップして追加します。
    * **重要**: このアクションは③の「繰り返し」の中にドラッグ＆ドロップして配置してください。

#### ⑥ 「If 繰り返しインデックス が次と等しい 1 の場合」

* **何をするアクション？**: 繰り返し処理の「最初の1回目」かどうかを判断します。最初の1回目だけ特定の処理を行い、2回目以降は別の処理を行うために使います。
* **追加方法**:
    1.  検索バーで「If」と検索します。
    2.  「If文」をタップして追加します。
    3.  「If」の右側の「`条件`」をタップし、表示される選択肢から「マジック変数」の「`繰り返しインデックス`」を選択します。
    4.  「`が次と等しい`」はそのままで、「`テキスト`」の部分をタップして「`1`」と入力します。
    * **重要**: このアクションも③の「繰り返し」の中にドラッグ＆ドロップして配置してください。⑤の「QRまたはバーコードをスキャン」の下に来るようにします。

#### ⑦ 「変数 URLList を QR/バーコード に設定」

* **何をするアクション？**: 初めてのQRコードをスキャンした場合に、スキャン結果を「URLList」という新しい変数に保存します。これが後でスキャンしたURLのリストの最初の要素になります。
* **追加方法**:
    1.  検索バーで「変数を設定」と検索します。
    2.  「変数を設定」をタップして追加します。
    3.  「変数」の部分をタップして、「新規変数」を選択し、名前を「`URLList`」と入力します。
    4.  「に設定」の右側の青い「`変数`」をタップし、表示されるマジック変数から「QR/バーコード（⑤でスキャンした内容）」を選択します。
    * **重要**: このアクションは⑥の「If」の中（「If文」と「その他の場合」の間）にドラッグ＆ドロップして配置してください。

#### ⑧ 「その他の場合」

* **何をするアクション？**: 繰り返し処理が2回目以降の場合に実行される部分です。
* **追加方法**: これは⑥の「If」アクションを配置すると自動的に追加されます。特に操作は不要です。

#### ⑨ 「QR/バーコード を URLList に追加」

* **何をするアクション？**: 2回目以降のQRコードスキャン結果を、既存の「URLList」変数に追加していきます。これにより、複数のQRコードの内容が1つのリストにまとめられます。
* **追加方法**:
    1.  検索バーで「リストに追加」と検索します。
    2.  「リストに追加」をタップして追加します。
    3.  「項目」の部分をタップし、マジック変数から「QR/バーコード（⑤でスキャンした内容）」を選択します。
    4.  「`に`」の右側の青い「`変数`」をタップし、マジック変数から「変数 URLList」を選択します。
    * **重要**: このアクションは⑧の「その他の場合」の中（「その他の場合」と「If文の終了」の間）にドラッグ＆ドロップして配置してください。

#### ⑩ 「If文の終了」

* **何をするアクション？**: ⑥の「If」条件分岐の終わりを示します。
* **追加方法**: ⑥の「If」アクションを配置すると自動的に追加されます。

#### ⑪ 「繰り返しの終了」

* **何をするアクション？**: ③の「繰り返し」処理の終わりを示します。
* **追加方法**: ③の「繰り返し」アクションを配置すると自動的に追加されます。

#### ⑫ 「変数 URLs を URLList に設定」

* **何をするアクション？**: 繰り返し処理が終わった後、最終的に作成されたURLのリスト（URLList）を「URLs」という別の変数にコピーします。これは次のアクションに渡すための準備です。
* **追加方法**:
    1.  検索バーで「変数を設定」と検索します。
    2.  「変数を設定」をタップして追加します。
    3.  「変数」の部分をタップして、「新規変数」を選択し、名前を「`URLs`」と入力します。
    4.  「に設定」の右側の青い「`変数`」をタップし、表示されるマジック変数から「変数 URLList」を選択します。
    * **重要**: このアクションは⑪の「繰り返しの終了」の**外側（下）**に配置してください。

#### ⑬「Run XMLMergev9 1 with URLs」

* **何をするアクション？**: スキャンしたURLのリスト（URLs）を引数として、別のショートカット「XMLMerge」を実行します。この部分の具体的な動作は、「XMLMerge」ショートカットの内容に依存します。
* **追加方法**:
    1.  検索バーで「ショートカットを実行」と検索します。
    2.  「ショートカットを実行」をタップして追加します。
    3.  「`ショートカット`」の部分をタップし、ショートカットの一覧から「`XMLMergev9 1`」を選択します。（このショートカットが存在しない場合は、エラーになります。もし連携しない場合は、このアクションを削除しても構いません。）
    4.  「`入力を渡す`」が「オン」になっていることを確認し、「`入力`」の部分をタップして、マジック変数から「変数 URLs」を選択します。

### 3. ショートカットの名前を設定

1.  画面上部の「新規ショートカット」と書かれている部分をタップします。
2.  「名称変更」を選択し、ショートカットの分かりやすい名前（例: `複数QRスキャン` など）を入力して「完了」をタップします。
3.  画面右上の「完了」ボタンをタップしてショートカットの作成を終了します。

---

## ?? ショートカットの実行方法

1.  ショートカットアプリで作成したショートカットをタップして実行します。
2.  「QRコードを撮影します」というアラートが表示された後、カメラが起動します。
3.  スキャンしたいQRコードやバーコードをカメラで読み取ります。
4.  「CardCount」で指定した回数分、このスキャンとアラート表示が繰り返されます。
5.  その後、「XMLMerge」ショートカットが実行されます。

